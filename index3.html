<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KDA Student Achievement Portal — Single File</title>
  <meta name="description" content="KDA Student Achievement Portal: Achievements, Profiles, Gallery, News & Admin (single-file, ready for GitHub)">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- Reset & base --- */
    :root{--blue:#0b63d4;--dark:#0b2340;--muted:#6b7280;--card:#ffffff;--glass:rgba(255,255,255,0.6)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;line-height:1.4;background:#f4f7fb;color:var(--dark)}
    a{color:inherit;text-decoration:none}

    /* --- Layout --- */
    header{background:linear-gradient(90deg,var(--blue),#2a9df4);padding:18px 20px;color:#fff;display:flex;align-items:center;gap:18px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .brand .logo{width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-weight:700}
    nav{margin-left:auto;display:flex;gap:12px;flex-wrap:wrap}
    nav button{background:transparent;border:2px solid rgba(255,255,255,0.12);color:white;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    nav button.active{background:white;color:var(--blue)}

    main{max-width:1100px;margin:24px auto;padding:0 18px}
    .hero{background:linear-gradient(180deg,rgba(11,99,212,0.08),transparent);padding:24px;border-radius:14px;display:flex;align-items:center;gap:18px}
    .hero .left{flex:1}
    .hero h1{margin:0;font-size:1.6rem}
    .hero p{margin:6px 0;color:var(--muted)}
    .hero .cta{margin-top:10px}
    .btn{background:var(--blue);color:white;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}

    /* --- Sections --- */
    section{margin-top:18px}
    .grid{display:grid;gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(13,30,80,0.06)}

    /* Achievement cards */
    .achievements .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .search{flex:1;display:flex;gap:8px}
    .search input{flex:1;padding:10px;border-radius:8px;border:1px solid #d7e2f3}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 10px;border-radius:999px;background:#eef6ff;border:1px solid #d9efff;font-weight:600;color:var(--blue);cursor:pointer}

    .achievement-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:12px}
    .achievement-item{overflow:hidden}
    .achievement-item img{width:100%;height:150px;object-fit:cover;border-radius:10px}
    .achievement-meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .tag{padding:6px 8px;border-radius:8px;background:#f0f6ff;color:var(--blue);font-weight:700}

    /* Profile modal */
    .modal{position:fixed;inset:0;background:rgba(5,10,20,0.4);display:none;align-items:center;justify-content:center;padding:20px}
    .modal.open{display:flex}
    .modal .modal-card{width:100%;max-width:760px;background:white;padding:18px;border-radius:10px}
    .profile{display:flex;gap:18px}
    .avatar{width:120px;height:120px;border-radius:10px;background:#eef3ff;display:flex;align-items:center;justify-content:center;font-weight:700}

    /* Gallery */
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}
    .gallery-grid img{width:100%;height:110px;object-fit:cover;border-radius:8px}

    /* News */
    .news-item{display:flex;gap:12px;align-items:flex-start}
    .news-item img{width:90px;height:70px;object-fit:cover;border-radius:8px}

    /* Admin */
    .admin-grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
    label{display:block;margin-top:8px;font-weight:600;color:var(--muted);font-size:0.9rem}
    input[type=text],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #d7e2f3;margin-top:6px}
    textarea{min-height:100px}
    .small{font-size:0.9rem;color:var(--muted)}
    .danger{background:#ffefef;border:1px solid #ffd1d1}

    /* Footer */
    footer{margin:26px 0;text-align:center;color:var(--muted);font-size:0.9rem}

    /* Responsive */
    @media (max-width:820px){
      .admin-grid{grid-template-columns:1fr}
      .hero{flex-direction:column;align-items:flex-start}
      nav{width:100%;justify-content:flex-start}
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">KDA</div>
    <div>
      <div style="font-size:0.95rem">KDA Student Achievement Portal</div>
      <div style="font-size:0.75rem;color:rgba(255,255,255,0.85)">Celebrate • Share • Inspire</div>
    </div>
  </div>

  <nav>
    <button class="nav-btn active" data-target="home">Home</button>
    <button class="nav-btn" data-target="achievements">Achievements</button>
    <button class="nav-btn" data-target="gallery">Gallery</button>
    <button class="nav-btn" data-target="news">News</button>
    <button class="nav-btn" data-target="admin">Admin</button>
  </nav>
</header>

<main>
  <!-- HOME / HERO -->
  <section id="home" class="card hero">
    <div class="left">
      <h1>Celebrating Excellence at KDA</h1>
      <p>Central place to share student achievements — academics, sports, arts, leadership, and more. Teachers can add entries from the Admin panel and achievements are saved in the browser (localStorage).</p>
      <div class="cta"><button class="btn" data-target="achievements">Browse Achievements</button></div>
    </div>
    <div style="width:280px" class="card">
      <strong>Quick stats</strong>
      <div style="margin-top:10px" class="small">Total achievements: <span id="stat-count">0</span></div>
      <div class="small">Categories: <span id="stat-cats">—</span></div>
      <div style="margin-top:12px"><button class="btn" data-target="admin">Add Achievement</button></div>
    </div>
  </section>

  <!-- ACHIEVEMENTS -->
  <section id="achievements" class="achievements" style="display:none">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h2 style="margin:0">Student Achievements</h2>
          <div class="small">Search, filter, and view achievements. Click a student's name to view full profile.</div>
        </div>

        <div class="controls">
          <div class="search">
            <input id="q" placeholder="Search by name, category, or description..." />
            <select id="filter-cat">
              <option value="all">All categories</option>
            </select>
          </div>
          <div class="chips" id="chip-list"></div>
        </div>
      </div>

      <div class="achievement-list" id="achievement-list"></div>
    </div>
  </section>

  <!-- GALLERY -->
  <section id="gallery" style="display:none">
    <div class="card">
      <h2 style="margin-top:0">Photo & Video Gallery</h2>
      <div class="small">Click an image to open in a new tab. Video entries will open the provided URL.</div>
      <div class="gallery-grid" id="gallery-grid" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- NEWS -->
  <section id="news" style="display:none">
    <div class="card">
      <h2 style="margin-top:0">News & Updates</h2>
      <div id="news-list" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="admin" style="display:none">
    <div class="card admin-grid">
      <div>
        <h2 style="margin-top:0">Admin — Add / Manage Achievements</h2>
        <div class="small">Entries are stored in your browser. For a persistent, shared site you'd connect this to a server or GitHub-hosted JSON file.</div>

        <form id="admin-form" style="margin-top:12px">
          <label>Student full name</label>
          <input type="text" id="f-name" required placeholder="e.g. Alice Uwase" />

          <label>Category</label>
          <select id="f-category" required>
            <option value="Academics">Academics</option>
            <option value="Sports">Sports</option>
            <option value="Arts">Arts</option>
            <option value="Leadership">Leadership</option>
            <option value="Other">Other</option>
          </select>

          <label>Title / Short achievement</label>
          <input type="text" id="f-title" placeholder="e.g. Top in National Exams 2025" required />

          <label>Description (optional)</label>
          <textarea id="f-desc" placeholder="Details about the achievement, event, award..."></textarea>

          <label>Image URL (optional)</label>
          <input type="text" id="f-img" placeholder="https://... (or leave blank for default)" />

          <label>Type</label>
          <select id="f-type">
            <option value="achievement">Achievement</option>
            <option value="gallery">Gallery image</option>
            <option value="news">News item</option>
          </select>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button type="submit" class="btn">Save</button>
            <button type="button" id="btn-clear" class="danger" style="padding:10px 12px;border-radius:8px">Clear All</button>
            <button type="button" id="btn-export" style="padding:10px 12px;border-radius:8px">Export JSON</button>
            <input id="import-file" type="file" accept="application/json" style="display:none" />
            <button type="button" id="btn-import" style="padding:10px 12px;border-radius:8px">Import JSON</button>
          </div>
        </form>
      </div>

      <div>
        <h3>Preview / Quick actions</h3>
        <div class="small">Click a student in the Achievements page to open their profile. You can delete entries from the list there.</div>

        <div style="margin-top:12px">
          <strong>Seed data</strong>
          <div class="small">Use the button to restore sample entries.</div>
          <div style="margin-top:8px"><button id="btn-seed" class="btn">Restore sample data</button></div>
        </div>

        <div style="margin-top:18px">
          <strong>Storage</strong>
          <div class="small">LocalStorage key: <code>kda_entries</code></div>
          <div style="margin-top:8px"><button id="btn-clear-storage" class="danger">Delete storage</button></div>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- Profile Modal -->
<div id="modal" class="modal" aria-hidden>
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
      <h3 id="modal-title">Profile</h3>
      <div><button id="modal-close" class="btn">Close</button></div>
    </div>
    <div style="margin-top:12px" id="modal-body"></div>
  </div>
</div>

<footer>
  © <span id="year"></span> KDA Student Achievement Portal — Made by Niyoshimwe Sam
</footer>

<script>
  // Single-file JS: manages state, UI, localStorage
  const NAV_BTN = document.querySelectorAll('.nav-btn')
  const sections = ['home','achievements','gallery','news','admin']
  function showSection(id){
    sections.forEach(s=>document.getElementById(s).style.display = (s===id)?'block':'none')
    NAV_BTN.forEach(b=>b.classList.toggle('active', b.dataset.target===id))
  }
  document.querySelectorAll('[data-target]').forEach(b => b.addEventListener('click', e=>showSection(b.dataset.target)))
  NAV_BTN.forEach(b=>b.addEventListener('click',()=>showSection(b.dataset.target)))
  showSection('home')

  // Utilities
  const STORAGE_KEY = 'kda_entries'
  const YEAR_EL = document.getElementById('year'); YEAR_EL.textContent = new Date().getFullYear()

  function uid(){return 'id_'+Math.random().toString(36).slice(2,9)}

  // Seed data
  const seed = [
    {id:uid(),type:'achievement',name:'Alice Uwase',category:'Academics',title:'Top in National Exams 2025',desc:'Scored highest in the district; scholarship awarded.',img:'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=eea6c7b3b7c6d3fef2b3c2b0e7b6c9b2'},
    {id:uid(),type:'achievement',name:'Eric Ndayisenga',category:'Sports',title:'Captain — Inter-school Football Winners',desc:'Led the team to win regional cup.',img:'https://images.unsplash.com/photo-1521412644187-c49fa049e84d?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=5d6d0b6f9ff2b4162c3f6c7bb6c3d9c1'},
    {id:uid(),type:'achievement',name:'Grace Ingabire',category:'Arts',title:'1st place — Regional Art Competition',desc:'Contemporary painting exhibited at the regional gallery.',img:'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=dd3b1f0b2ae7f9c7b1d0e0f1a2b3c4d5'},
    {id:uid(),type:'gallery',title:'School Football Team',img:'https://images.unsplash.com/photo-1509228627159-6452a3f2b3b4?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e'},
    {id:uid(),type:'news',title:'KDA wins regional sports day',desc:'KDA finished top of the table at the regional sports day, bringing pride to the school.'}
  ]

  // Load / Save
  function loadEntries(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY)
      if(!raw) return seed.slice()
      const data = JSON.parse(raw)
      if(!Array.isArray(data) || data.length===0) return seed.slice()
      return data
    }catch(err){return seed.slice()}
  }
  function saveEntries(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)) }

  // Current state
  let entries = loadEntries()

  // UI references
  const achievementListEl = document.getElementById('achievement-list')
  const galleryGrid = document.getElementById('gallery-grid')
  const newsList = document.getElementById('news-list')
  const statCount = document.getElementById('stat-count')
  const statCats = document.getElementById('stat-cats')
  const qInput = document.getElementById('q')
  const filterCat = document.getElementById('filter-cat')
  const chipList = document.getElementById('chip-list')

  // Modal
  const modal = document.getElementById('modal')
  const modalTitle = document.getElementById('modal-title')
  const modalBody = document.getElementById('modal-body')
  document.getElementById('modal-close').addEventListener('click', ()=>modal.classList.remove('open'))
  modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('open') })

  // Render functions
  function render(){
    renderAchievements()
    renderGallery()
    renderNews()
    renderStats()
    populateFilter()
  }

  function renderAchievements(){
    const q = (qInput?.value||'').toLowerCase()
    const cat = filterCat.value
    const list = entries.filter(e=>e.type==='achievement')
      .filter(e=> (cat==='all') ? true : e.category===cat )
      .filter(e=>{
        if(!q) return true
        return [e.name,e.title,e.desc,e.category].join(' ').toLowerCase().includes(q)
      })

    achievementListEl.innerHTML = ''
    if(list.length===0){ achievementListEl.innerHTML = '<div class="small">No achievements found.</div>'; return }

    list.forEach(item=>{
      const card = document.createElement('div')
      card.className = 'card achievement-item'
      card.innerHTML = `
        <img src="${item.img||defaultImg(item.name)}" alt="${escapeHtml(item.title||item.name)}">
        <div style="margin-top:8px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700;cursor:pointer" data-id="${item.id}" data-action="open">${escapeHtml(item.name)}</div>
            <div class="tag">${escapeHtml(item.category||'General')}</div>
          </div>
          <div style="margin-top:6px;font-weight:600">${escapeHtml(item.title||'Achievement')}</div>
          <div style="margin-top:6px;color:var(--muted)">${escapeHtml(shorten(item.desc||'',120))}</div>
          <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
            <button class="btn" data-id="${item.id}" data-action="open">View Profile</button>
            <button style="padding:8px 10px;border-radius:8px" data-id="${item.id}" data-action="delete">Delete</button>
          </div>
        </div>`

      achievementListEl.appendChild(card)
    })

    // attach events
    achievementListEl.querySelectorAll('[data-action="open"]').forEach(b=>b.addEventListener('click', e=>openProfile(b.dataset.id)))
    achievementListEl.querySelectorAll('[data-action="delete"]').forEach(b=>b.addEventListener('click', e=>{ if(confirm('Delete this entry?')){ deleteEntry(b.dataset.id) } }))
  }

  function renderGallery(){
    const list = entries.filter(e=>e.type==='gallery')
    galleryGrid.innerHTML = ''
    if(list.length===0){ galleryGrid.innerHTML = '<div class="small">No gallery items.</div>'; return }
    list.forEach(g=>{
      const el = document.createElement('a')
      el.href = g.img||'#'
      el.target = '_blank'
      el.rel = 'noopener'
      el.innerHTML = `<img src="${g.img||defaultImg('Gallery')}" alt="${escapeHtml(g.title||'Gallery')}">`
      galleryGrid.appendChild(el)
    })
  }

  function renderNews(){
    const list = entries.filter(e=>e.type==='news')
    newsList.innerHTML = ''
    if(list.length===0){ newsList.innerHTML = '<div class="small">No news items.</div>'; return }
    list.forEach(n=>{
      const el = document.createElement('div')
      el.className = 'card news-item'
      el.style.marginBottom = '10px'
      el.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(n.title||'News')}</div>
          <div class="small" style="margin-top:6px">${escapeHtml(shorten(n.desc||'',180))}</div>
        </div>`
      newsList.appendChild(el)
    })
  }

  function renderStats(){
    const total = entries.filter(e=>e.type==='achievement').length
    statCount.textContent = total
    const cats = [...new Set(entries.filter(e=>e.type==='achievement').map(e=>e.category))]
    statCats.textContent = cats.length?cats.join(', '):'—'
  }

  function populateFilter(){
    const cats = [...new Set(entries.filter(e=>e.type==='achievement').map(e=>e.category))]
    filterCat.innerHTML = '<option value="all">All categories</option>' + cats.map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('')

    chipList.innerHTML = cats.map(c=>`<div class="chip" data-cat="${escapeHtml(c)}">${escapeHtml(c)}</div>`).join('')
    chipList.querySelectorAll('.chip').forEach(ch=>ch.addEventListener('click', ()=>{ filterCat.value = ch.dataset.cat; renderAchievements() }))
  }

  // Actions
  function openProfile(id){
    const item = entries.find(e=>e.id===id)
    if(!item) return alert('Entry not found')
    modalTitle.textContent = item.name || item.title || 'Profile'
    modalBody.innerHTML = `
      <div class="profile">
        <div style="flex:0 0 140px">
          <div class="avatar"><img src="${item.img||defaultImg(item.name)}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:8px"></div>
        </div>
        <div style="flex:1">
          <div style="font-weight:700;font-size:1.05rem">${escapeHtml(item.name||item.title)}</div>
          <div style="margin-top:6px"><span class="tag">${escapeHtml(item.category||'General')}</span></div>
          <div style="margin-top:10px;color:var(--muted)">${escapeHtml(item.title||'')}</div>
          <div style="margin-top:8px">${escapeHtml(item.desc||'—')}</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <a class="btn" href="${item.img||'#'}" target="_blank" rel="noopener">Open media</a>
            <button style="padding:8px 10px;border-radius:8px" onclick="if(confirm('Delete this entry?')){window.deleteEntryFromModal&&window.deleteEntryFromModal('${item.id}')}" >Delete</button>
          </div>
        </div>
      </div>`
    modal.classList.add('open')

    // expose function for delete from modal
    window.deleteEntryFromModal = (id)=>{ deleteEntry(id); modal.classList.remove('open') }
  }

  function deleteEntry(id){ entries = entries.filter(e=>e.id!==id); saveEntries(entries); render(); }

  // Form handling
  document.getElementById('admin-form').addEventListener('submit', function(e){
    e.preventDefault()
    const name = document.getElementById('f-name').value.trim()
    const category = document.getElementById('f-category').value
    const title = document.getElementById('f-title').value.trim()
    const desc = document.getElementById('f-desc').value.trim()
    const img = document.getElementById('f-img').value.trim()
    const type = document.getElementById('f-type').value

    const entry = { id: uid(), type: type, name, category, title, desc, img }
    entries.unshift(entry)
    saveEntries(entries)
    this.reset()
    showSection('achievements')
    render()
    alert('Saved — entry added')
  })

  document.getElementById('btn-seed').addEventListener('click', ()=>{ if(confirm('Restore sample data? This will replace current entries in this browser.')){ entries = seed.slice(); saveEntries(entries); render(); alert('Sample data restored') } })

  document.getElementById('btn-clear-storage').addEventListener('click', ()=>{ if(confirm('Delete all stored entries? This cannot be undone.')){ localStorage.removeItem(STORAGE_KEY); entries = []; render(); alert('Storage cleared') } })

  document.getElementById('btn-clear').addEventListener('click', ()=>{ if(confirm('Clear all entries?')){ entries=[]; saveEntries(entries); render(); alert('All entries removed') } })

  // Export / Import
  document.getElementById('btn-export').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(entries, null, 2)], {type:'application/json'})
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a'); a.href = url; a.download = 'kda_entries.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url)
  })
  document.getElementById('btn-import').addEventListener('click', ()=>document.getElementById('import-file').click())
  document.getElementById('import-file').addEventListener('change', function(){
    const f = this.files[0]; if(!f) return
    const r = new FileReader(); r.onload = ()=>{
      try{ const data = JSON.parse(r.result); if(!Array.isArray(data)) throw new Error('Invalid format'); entries = data; saveEntries(entries); render(); alert('Imported') }catch(err){ alert('Invalid JSON file') }
    }; r.readAsText(f)
  })

  // Search / Filter interactions
  qInput?.addEventListener('input', ()=>renderAchievements())
  filterCat?.addEventListener('change', ()=>renderAchievements())

  // Helpers
  function shorten(text, n){ if(!text) return ''; return text.length>n?text.slice(0,n-1)+'…':text }
  function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }
  function defaultImg(seedText){ // simple SVG placeholder data URI
    const txt = encodeURIComponent((seedText||'KDA').slice(0,12))
    return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="450"><rect width="100%" height="100%" fill="#eaf4ff"/><text x="50%" y="50%" font-family="Poppins,Arial" font-size="36" text-anchor="middle" fill="#0b63d4" dy=".3em">${txt}</text></svg>`)
  }

  // Escape for building option values
  function escapeHtmlAttr(s){ return (s||'').replace(/"/g,'&quot;') }

  // Expose delete for modal
  window.deleteEntry = deleteEntry

  // Initial render
  render()

</script>
</body>
</html>
